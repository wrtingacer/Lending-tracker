<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal Debt Tracker - Track money you owe and money owed to you. Multi-currency support.">
    <title>Personal Debt Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <!-- i18next CDN -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.8.0/dist/commonjs/i18next.js"></script>
</head>
<body>
    <!-- Offline Banner -->
    <div id="offline-banner" class="offline-banner" role="alert" aria-live="assertive" style="display:none;">
        <span>âš ï¸ You are offline. Changes will sync when you reconnect.</span>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal onboarding-modal" role="dialog" aria-modal="true" aria-label="Welcome Onboarding">
        <div class="modal-content onboarding-content">
            <div class="onboarding-progress">
                <div class="onboarding-dot active" data-step="0"></div>
                <div class="onboarding-dot" data-step="1"></div>
                <div class="onboarding-dot" data-step="2"></div>
                <div class="onboarding-dot" data-step="3"></div>
            </div>
            <div class="onboarding-step active" data-step="0">
                <div class="onboarding-icon">ğŸ‘‹</div>
                <h2 i18n="onboarding.welcome_title">Welcome to Debt Tracker!</h2>
                <p i18n="onboarding.welcome_desc">Your smart tool for managing debts and tracking money owed to and from others.</p>
            </div>
            <div class="onboarding-step" data-step="1">
                <div class="onboarding-icon">ğŸ’³</div>
                <h2 i18n="onboarding.track_title">Track Both Ways</h2>
                <p i18n="onboarding.track_desc">Switch between <strong>Money I Owe</strong> and <strong>Money Owed To Me</strong> using the toggle at the top.</p>
            </div>
            <div class="onboarding-step" data-step="2">
                <div class="onboarding-icon">ğŸ’°</div>
                <h2 i18n="onboarding.currency_title">Multi-Currency Support</h2>
                <p i18n="onboarding.currency_desc">Add debts in KES, USD, EUR and more. Live exchange rates are fetched automatically.</p>
            </div>
            <div class="onboarding-step" data-step="3">
                <div class="onboarding-icon">ğŸš€</div>
                <h2 i18n="onboarding.ready_title">You're All Set!</h2>
                <p i18n="onboarding.ready_desc">Start by adding your first debt or switching language in settings. We're here to help!</p>
            </div>
            <div class="onboarding-buttons">
                <button id="onboarding-prev" class="btn btn-secondary btn-sm" style="display:none;" type="button" aria-label="Previous step">â† Previous</button>
                <button id="onboarding-next" class="btn btn-primary btn-sm" type="button" aria-label="Next step">Next â†’</button>
                <button id="onboarding-skip" class="btn btn-secondary btn-sm" type="button" aria-label="Skip tutorial">Skip</button>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Main Content -->
        <div class="container">
            <!-- Header -->
            <header class="header" role="banner">
                <button class="theme-toggle" id="theme-toggle" type="button" aria-label="Toggle dark mode">ğŸŒ™</button>
                <button class="lang-toggle" id="lang-toggle" type="button" aria-label="Switch language">ğŸ‡¬ğŸ‡§ EN</button>
                <h1>ğŸ’³ <span i18n="app.title">Debt Tracker</span></h1>
                <p i18n="app.subtitle">Track money you owe & money owed to you</p>
            </header>

            <div class="content">
                <!-- Auth Section -->
                <div id="auth-section" aria-label="Authentication">
                    <h2 style="text-align:center;margin-bottom:20px;" i18n="auth.title">Sign In or Create Account</h2>
                    <div class="input-group">
                        <label for="email" i18n="auth.email">Email</label>
                        <input type="email" id="email" placeholder="you@email.com" aria-required="true" autocomplete="email">
                    </div>
                    <div class="input-group">
                        <label for="password" i18n="auth.password">Password</label>
                        <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" aria-required="true" autocomplete="current-password">
                    </div>
                    <button id="login-btn" class="btn btn-primary" type="button" aria-label="Log in">Log In</button>
                    <button id="signup-btn" class="btn btn-secondary" type="button" style="width:100%;" aria-label="Create new account">Create Account</button>
                    <div id="auth-message" role="alert" aria-live="polite"></div>
                </div>

                <!-- App Section -->
                <div id="app-section" style="display:none;" aria-label="Main application">
                    <!-- User Info Bar -->
                    <div class="user-info">
                        <span><strong i18n="app.logged_as">Logged in as:</strong> <span id="user-email"></span></span>
                        <div class="user-actions">
                            <button id="feedback-btn" class="btn btn-secondary btn-sm" type="button" aria-label="Send feedback">ğŸ’¬ Feedback</button>
                            <button id="backup-btn" class="btn btn-secondary btn-sm" type="button" aria-label="Backup data">ğŸ’¾ Backup</button>
                            <button id="logout-btn" class="btn btn-secondary btn-sm" type="button" aria-label="Log out">Log Out</button>
                        </div>
                    </div>

                    <!-- Direction Toggle: Owe vs Owed -->
                    <div class="direction-toggle-section">
                        <button id="toggle-owe" class="direction-btn active" type="button" aria-pressed="true">ğŸ’¸ <span i18n="toggle.owe">Money I Owe</span></button>
                        <button id="toggle-owed" class="direction-btn" type="button" aria-pressed="false">ğŸ’° <span i18n="toggle.owed">Money Owed To Me</span></button>
                    </div>

                    <!-- Currency Selector -->
                    <div class="currency-bar">
                        <label for="currency-select" i18n="currency.label">Currency:</label>
                        <select id="currency-select" aria-label="Select currency">
                            <option value="KES">ğŸ‡°ğŸ‡ª KES - Kenyan Shilling</option>
                            <option value="USD">ğŸ‡ºğŸ‡¸ USD - US Dollar</option>
                            <option value="EUR">ğŸ‡ªğŸ‡º EUR - Euro</option>
                            <option value="GBP">ğŸ‡¬ğŸ‡§ GBP - British Pound</option>
                            <option value="ZAR">ğŸ‡¿ğŸ‡¦ ZAR - South African Rand</option>
                            <option value="NGN">ğŸ‡³ğŸ‡¬ NGN - Nigerian Naira</option>
                            <option value="TZS">ğŸ‡¹ğŸ‡¿ TZS - Tanzanian Shilling</option>
                        </select>
                        <span id="exchange-rate-display" class="exchange-info" aria-live="polite"></span>
                    </div>

                    <!-- Search & Filter -->
                    <div class="filters-section" aria-label="Search and filter">
                        <h3>ğŸ” <span i18n="filter.title">Search & Filter</span></h3>
                        <div class="filters-row">
                            <input type="text" id="search-input" placeholder="Search..." aria-label="Search by name">
                            <select id="sort-select" aria-label="Sort debts">
                                <option value="date-desc">Newest First</option>
                                <option value="date-asc">Oldest First</option>
                                <option value="amount-desc">Highest Amount</option>
                                <option value="amount-asc">Lowest Amount</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="due-asc">Due Date (Soonest)</option>
                            </select>
                        </div>
                        <div class="filter-tags" role="group" aria-label="Filter options">
                            <div class="filter-tag active" data-filter="all" role="button" tabindex="0">All</div>
                            <div class="filter-tag" data-filter="unpaid" role="button" tabindex="0">Unpaid</div>
                            <div class="filter-tag" data-filter="paid" role="button" tabindex="0">Paid</div>
                            <div class="filter-tag" data-filter="overdue" role="button" tabindex="0">Overdue</div>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="stats" role="region" aria-label="Financial summary">
                        <div class="stat-card"><h3>Total</h3><div class="amount"><span id="stat-currency">KES</span> <span id="total-amount">0.00</span></div></div>
                        <div class="stat-card"><h3>Repaid</h3><div class="amount"><span id="stat-currency2">KES</span> <span id="total-repaid">0.00</span></div></div>
                        <div class="stat-card"><h3>Remaining</h3><div class="amount"><span id="stat-currency3">KES</span> <span id="still-owe">0.00</span></div></div>
                        <div class="stat-card"><h3>Interest</h3><div class="amount"><span id="stat-currency4">KES</span> <span id="total-interest">0.00</span></div></div>
                        <div class="stat-card"><h3>Active</h3><div class="amount"><span id="active-debts">0</span></div></div>
                    </div>

                    <!-- Analytics -->
                    <div class="analytics-section" aria-label="Analytics">
                        <h3>ğŸ“ˆ <span i18n="analytics.title">Insights</span></h3>
                        <div class="analytics-grid">
                            <div class="analytics-item"><h4>Avg Amount</h4><div class="value" id="avg-debt">0</div></div>
                            <div class="analytics-item"><h4>Avg Repayment</h4><div class="value"><span id="avg-repayment">0</span> days</div></div>
                            <div class="analytics-item"><h4 id="top-person-label">Top Person</h4><div class="value" id="top-person">-</div></div>
                            <div class="analytics-item"><h4>Total People</h4><div class="value" id="total-people">0</div></div>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="chart-container" aria-label="Debt chart">
                        <h3>ğŸ“Š <span i18n="chart.title">Overview</span></h3>
                        <div class="bar-chart" id="debt-chart" role="img" aria-label="Bar chart of debts"></div>
                    </div>

                    <!-- Reminders -->
                    <div class="notification-section" aria-label="Reminder settings">
                        <h3>ğŸ”” <span i18n="reminder.title">Reminders</span></h3>
                        <div class="filters-row">
                            <input type="number" id="remind-days" value="3" min="1" max="30" aria-label="Days before due date">
                            <div>
                                <span id="notify-status">Click to enable</span>
                                <button id="notify-toggle" class="btn btn-secondary btn-sm" type="button">Enable</button>
                            </div>
                        </div>
                    </div>

                    <!-- Add Debt Form -->
                    <div class="form-section" aria-label="Add new debt form">
                        <h2 id="form-title">Add New Debt</h2>
                        <div class="quick-add-templates">
                            <button class="template-btn" data-template="small" type="button">ğŸ’µ Small</button>
                            <button class="template-btn" data-template="medium" type="button">ğŸ’° Medium</button>
                            <button class="template-btn" data-template="large" type="button">ğŸ’ Large</button>
                        </div>
                        <form id="debt-form" novalidate>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="person-name" id="person-label">Person Name *</label>
                                    <input type="text" id="person-name" placeholder="Name" required list="person-list" aria-required="true">
                                    <datalist id="person-list"></datalist>
                                </div>
                                <div class="input-group">
                                    <label for="amount">Amount *</label>
                                    <input type="number" id="amount" step="0.01" min="0.01" placeholder="100.00" required aria-required="true">
                                </div>
                                <div class="input-group">
                                    <label for="due-date">Due Date *</label>
                                    <input type="date" id="due-date" required aria-required="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="interest-rate">Interest Rate (%/yr)</label>
                                    <input type="number" id="interest-rate" step="0.1" min="0" max="100" placeholder="0">
                                </div>
                                <div class="input-group">
                                    <label for="interest-type">Interest Type</label>
                                    <select id="interest-type">
                                        <option value="none">No Interest</option>
                                        <option value="simple">Simple</option>
                                        <option value="compound">Compound (Monthly)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="enable-installments">
                                <label for="enable-installments">Enable Payment Plan</label>
                            </div>
                            <div id="installments-config" style="display:none;margin-top:15px;">
                                <div class="form-row">
                                    <div class="input-group">
                                        <label for="num-installments">Number of Installments</label>
                                        <input type="number" id="num-installments" min="2" max="60" placeholder="12">
                                    </div>
                                    <div class="input-group">
                                        <label for="installment-frequency">Frequency</label>
                                        <select id="installment-frequency">
                                            <option value="weekly">Weekly</option>
                                            <option value="biweekly">Bi-weekly</option>
                                            <option value="monthly" selected>Monthly</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="notes">Notes</label>
                                <textarea id="notes" placeholder="Details..."></textarea>
                            </div>
                            <div id="form-error" class="form-error" role="alert" aria-live="assertive"></div>
                            <button type="submit" class="btn btn-success" style="width:100%;" aria-label="Submit debt">Add Debt</button>
                        </form>
                    </div>

                    <!-- Debts List -->
                    <div style="margin-bottom:20px;">
                        <div class="list-header">
                            <h2>Your Debts (<span id="debt-count">0</span>)</h2>
                            <button id="export-btn" class="btn btn-secondary btn-sm" type="button" aria-label="Export to CSV">Export CSV</button>
                        </div>
                        <ul id="debts-list" aria-label="List of debts" role="list"></ul>
                    </div>

                    <!-- Bottom Ad -->
                    <div class="ad-space bottom-ad" aria-label="Advertisement">
                        <div><!-- Google AdSense / Ad Network Code Here --><p class="ad-label">Advertisement</p><p class="ad-size">728 x 90</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar" aria-label="Sidebar">
            <div class="ad-space sticky" aria-label="Advertisement">
                <div><!-- Ad Network Code Here --><p class="ad-label">Advertisement</p><p class="ad-size">300 x 250</p></div>
            </div>
            <div class="ad-space" aria-label="Advertisement">
                <div><!-- Ad Network Code Here --><p class="ad-label">Advertisement</p><p class="ad-size">300 x 250</p></div>
            </div>
        </aside>
    </div>

    <!-- Modals: Payment -->
    <div id="payment-modal" class="modal" role="dialog" aria-modal="true" aria-label="Record Payment">
        <div class="modal-content">
            <div class="modal-header"><h2>Record Payment</h2><button class="modal-close" id="close-payment-modal" type="button" aria-label="Close">âœ•</button></div>
            <form id="payment-form" novalidate>
                <div class="input-group"><label for="payment-amount">Amount *</label><input type="number" id="payment-amount" step="0.01" min="0.01" required aria-required="true"></div>
                <div class="input-group"><label for="payment-date">Date *</label><input type="date" id="payment-date" required aria-required="true"></div>
                <div class="input-group"><label for="payment-notes">Notes</label><textarea id="payment-notes" placeholder="Details..."></textarea></div>
                <!-- Payment Integrations -->
                <div class="payment-integrations">
                    <p class="integrations-label">Quick Pay via:</p>
                    <div class="integrations-row">
                        <button type="button" class="integration-btn mpesa-btn" aria-label="Pay with M-Pesa">ğŸ“± M-Pesa</button>
                        <button type="button" class="integration-btn paypal-btn" aria-label="Pay with PayPal">ğŸ…Ÿ PayPal</button>
                        <button type="button" class="integration-btn cashapp-btn" aria-label="Pay with Cash App">ğŸ’š Cash App</button>
                    </div>
                </div>
                <div id="payment-error" class="form-error" role="alert" aria-live="assertive"></div>
                <button type="submit" class="btn btn-success" style="width:100%;">Record Payment</button>
            </form>
        </div>
    </div>

    <!-- Modal: Reminder -->
    <div id="reminder-modal" class="modal" role="dialog" aria-modal="true" aria-label="Payment Reminder">
        <div class="modal-content">
            <div class="modal-header"><h2>Reminder</h2><button class="modal-close" id="close-reminder-modal" type="button" aria-label="Close">âœ•</button></div>
            <textarea id="reminder-text" rows="8" readonly aria-label="Reminder message"></textarea>
            <button class="copy-btn" id="copy-reminder-btn" type="button" aria-label="Copy reminder message">ğŸ“‹ Copy</button>
        </div>
    </div>

    <!-- Modal: Share -->
    <div id="share-modal" class="modal" role="dialog" aria-modal="true" aria-label="Share Debt">
        <div class="modal-content">
            <div class="modal-header"><h2>Share Debt Entry</h2><button class="modal-close" id="close-share-modal" type="button" aria-label="Close">âœ•</button></div>
            <div class="input-group">
                <label for="share-link">Shareable Link</label>
                <input type="text" id="share-link" readonly aria-label="Shareable link">
            </div>
            <button class="btn btn-info" id="copy-share-link" type="button" style="width:100%;" aria-label="Copy link">ğŸ“‹ Copy Link</button>
            <hr style="margin:15px 0;">
            <div class="input-group">
                <label for="share-mode">Access Mode</label>
                <select id="share-mode" aria-label="Choose share mode">
                    <option value="view">View Only</option>
                    <option value="edit">View & Edit</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Modal: Backup -->
    <div id="backup-modal" class="modal" role="dialog" aria-modal="true" aria-label="Backup and Restore">
        <div class="modal-content">
            <div class="modal-header"><h2>Backup & Restore</h2><button class="modal-close" id="close-backup-modal" type="button" aria-label="Close">âœ•</button></div>
            <button id="export-json-btn" class="btn btn-info" style="width:100%;margin-bottom:10px;" type="button">ğŸ“¥ Download Backup</button>
            <hr style="margin:15px 0;">
            <input type="file" id="import-json-input" accept=".json" aria-label="Select backup file">
            <button id="import-json-btn" class="btn btn-success" style="width:100%;margin-top:10px;" type="button">ğŸ“¤ Import Backup</button>
        </div>
    </div>

    <!-- Modal: Feedback -->
    <div id="feedback-modal" class="modal" role="dialog" aria-modal="true" aria-label="Send Feedback">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ’¬ Feedback & Suggestions</h2><button class="modal-close" id="close-feedback-modal" type="button" aria-label="Close">âœ•</button></div>
            <form id="feedback-form" novalidate>
                <div class="input-group">
                    <label for="feedback-rating">Rate your experience</label>
                    <div class="star-rating" role="group" aria-label="Rating">
                        <input type="radio" id="star5" name="rating" value="5"><label for="star5" aria-label="5 stars">â˜…</label>
                        <input type="radio" id="star4" name="rating" value="4"><label for="star4" aria-label="4 stars">â˜…</label>
                        <input type="radio" id="star3" name="rating" value="3"><label for="star3" aria-label="3 stars">â˜…</label>
                        <input type="radio" id="star2" name="rating" value="2"><label for="star2" aria-label="2 stars">â˜…</label>
                        <input type="radio" id="star1" name="rating" value="1"><label for="star1" aria-label="1 star">â˜…</label>
                    </div>
                </div>
                <div class="input-group">
                    <label for="feedback-type">Type</label>
                    <select id="feedback-type" aria-label="Feedback type">
                        <option value="suggestion">Suggestion</option>
                        <option value="bug">Bug Report</option>
                        <option value="general">General</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="feedback-text">Message *</label>
                    <textarea id="feedback-text" placeholder="Share your thoughts..." required aria-required="true"></textarea>
                </div>
                <button type="submit" class="btn btn-success" style="width:100%;">Submit Feedback</button>
            </form>
        </div>
    </div>

    <!-- Undo Toast -->
    <div class="undo-notification" id="undo-notification" role="alert" aria-live="assertive">
        <span id="undo-message">Deleted</span>
        <button class="btn btn-secondary btn-sm" id="undo-btn" type="button">â†©ï¸ Undo</button>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="footer-links">
            <a href="blog.html" aria-label="Visit our blog">ğŸ“° Blog & Tips</a>
            <a href="#" id="privacy-link" aria-label="Read privacy policy">ğŸ”’ Privacy Policy</a>
            <a href="#" id="terms-link" aria-label="Read terms of service">ğŸ“„ Terms</a>
        </div>
        <p class="footer-disclaimer">
            <strong>Disclaimer:</strong> This site may earn commissions from affiliate links and advertisements. 
            We only recommend products and services we believe in. Payments made via integrated apps (M-Pesa, PayPal, Cash App) 
            are processed by those platforms and are not managed by this site. Your data is stored securely via Firebase (HTTPS). 
            We comply with Kenya's Data Protection Act and GDPR. See <a href="#" id="privacy-link-footer">Privacy Policy</a> for details.
        </p>
        <p class="footer-copy">Â© 2025 Debt Tracker. All rights reserved.</p>
    </footer>

    <!-- Scripts -->
    <script src="i18n.js"></script>
    <script src="firebase.js"></script>
    <script src="app.js"></script>
</body>
</html>
